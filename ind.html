<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>KinoDivBox â€” Alloha Player</title>
<style>
  html, body {
    margin:0; padding:0; height:100%; width:100%;
    display:flex; justify-content:center; align-items:flex-start;
    background:#0b1020; color:#fff; font-family:Inter,Segoe UI,Arial,sans-serif;
  }
  .wrap {
    width:100%; max-width:100%; padding:0;
    display:flex; flex-direction:column; height:100%;
  }
  .player-wrap {
    width:100%; flex:1; display:flex; flex-direction:column;
  }
  .player-switch {
    display:flex; gap:8px; flex-wrap:wrap; padding:10px;
    background:rgba(0,0,0,0.3); width:100%; justify-content:center;
  }
  /* Ù‚Ù…Øª Ø¨Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù„Ø£Ù†Ù‡ ÙŠÙˆØ¬Ø¯ Ù…Ø´ØºÙ„ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·ØŒ Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª Ø¥Ø¸Ù‡Ø§Ø±Ù‡ Ø§Ø­Ø°Ù Ø§Ù„Ø³Ø·Ø± Ø§Ù„ØªØ§Ù„ÙŠ */
  /* .player-switch { display: none; } */ 
  
  .switch-btn {
    background:transparent; border:1px solid rgba(255,255,255,0.3);
    border-radius:8px; padding:6px 12px; cursor:pointer; color:#fff;
  }
  .switch-btn[aria-pressed="true"]{
    background:#ff4b1f; color:#fff; border-color:transparent;
  }
  #playerFrame {
    width:100%; flex:1; display:grid; place-items:center;
    background:rgba(255,255,255,0.02);
  }
  iframe { width:100%; height:100%; border:0; }
  .hidden { display:none; }
</style>
</head>
<body>
<div class="wrap">
  <section class="player-wrap" aria-live="polite">
    <div class="player-switch" role="tablist" aria-label="Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ¿Ğ»ĞµĞµÑ€Ğ°" id="playerSwitcher"></div>
    
    <div id="playerFrame" class="player-frame">
      <div id="empty" style="text-align:center;color:rgba(255,255,255,0.45);padding:12px">
        ğŸ¬ Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ID ĞšĞ¸Ğ½Ğ¾ĞŸĞ¾Ğ¸ÑĞºĞ° Ğ¸ Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Â«ĞŸĞ¾Ğ¸ÑĞºÂ»
      </div>
    </div>
  </section>
</div>

<script src="https://allohatv.github.io/insert-player.js"></script>

<script>
// Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´ØºÙ„Ø§Øª (ØªÙ… Ø­ØµØ±Ù‡Ø§ ÙÙŠ Alloha ÙÙ‚Ø·)
const players = {
  "Alloha": id => `https://harald-as.newplayjj.com/?kp=${id}&token=e7b61f129f4a392ac4bf6726a9dd6a`
};

function extractKP(input){
  if(!input) return '';
  input=input.trim();
  const m = input.match(/kinopoisk\.ru\/(?:film|series)\/(\d+)/i);
  if(m) return m[1];
  const digits = input.match(/\d{1,10}/);
  return digits ? digits[0] : '';
}

// Ø¯Ø§Ù„Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø´ØºÙ„Ø§Øª (Ù„Ù… ÙŠØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ù†Ø·Ù‚)
async function buildPlayers(id){
  const switcher = document.getElementById('playerSwitcher');
  const frame = document.getElementById('playerFrame');
  
  // ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
  switcher.innerHTML=''; 
  frame.innerHTML='<div>Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</div>';

  let created=0;
  
  // Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø§Ù„Ø¢Ù† Ø¹Ù„Ù‰ Ø¹Ù†ØµØ± ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·)
  for(const [name, fn] of Object.entries(players)){
    try{
      const src = typeof fn==='function' ? await fn(id) : null;
      if(!src) continue;
      
      const btn = document.createElement('button');
      btn.className='switch-btn'; btn.type='button'; btn.textContent=name;
      btn.setAttribute('role','tab'); btn.setAttribute('aria-pressed','false');
      
      btn.addEventListener('click', ()=>{
        [...switcher.children].forEach(b=>b.setAttribute('aria-pressed','false'));
        btn.setAttribute('aria-pressed','true'); 
        showPlayer(src, name);
      });
      
      switcher.appendChild(btn);
      created++;
    } catch(e){ console.warn('player build error', name, e); }
  }
  
  if(created===0){ frame.innerHTML='âŒ ĞŸĞ»ĞµĞµÑ€Ñ‹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹'; return; }
  
  // Ø§Ù„Ù†Ù‚Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø§Ù„Ø£ÙˆÙ„ (Alloha)
  switcher.querySelector('button')?.click();
}

// Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù€ iframe (Ù„Ù… ØªØªØºÙŠØ±)
function showPlayer(src, name){
  const frame = document.getElementById('playerFrame');
  const iframe = document.createElement('iframe');
  
  iframe.src = src; 
  iframe.loading = 'lazy';
  iframe.title = name; 
  iframe.allowFullscreen = true; 
  iframe.setAttribute('allow', 'autoplay; fullscreen; picture-in-picture');
  
  frame.innerHTML = ''; 
  frame.appendChild(iframe);
}

// Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·
(function(){
  const params = new URLSearchParams(location.search);
  const id = params.get('id');
  if(id) buildPlayers(id);
})();
</script>
</body>
</html>
