<!doctype html>
<html lang="ru">
<body>

<div class="wrap">
  <section class="player-wrap">
    <div id="playerFrame" class="player-frame"></div>
    <pre id="result">جاري الاتصال...</pre>
  </section>
</div>

<script src="https://allohatv.github.io/insert-player.js"></script>

<script>
const players = {
  "Alloha": id => `https://harald-as.newplayjj.com/?kp=${id}&token=e7b61f129f4a392ac4bf6726a9dd6a`
};

// دالة استخراج المعرف
function extractKP(input){
  if(!input) return '';
  input = input.trim();
  const m = input.match(/kinopoisk\.ru\/(?:film|series)\/(\d+)/i);
  if(m) return m[1];
  const digits = input.match(/\d{1,10}/);
  return digits ? digits[0] : '';
}

// التعديل الرئيسي هنا: تحميل مباشر بدون أزرار
async function buildPlayers(id){
  const frame = document.getElementById('playerFrame');
  frame.innerHTML = '<div>Загрузка...</div>'; // جاري التحميل

  // المرور على قائمة المشغلات
  for(const [name, fn] of Object.entries(players)){
    try{
      // محاولة جلب الرابط
      const src = typeof fn === 'function' ? await fn(id) : null;
      
      // إذا تم العثور على رابط صالح
      if(src) {
        // 1. اعرض المشغل فوراً
        showPlayer(src, name);
        // 2. أوقف الدالة هنا (لا حاجة للبحث عن مشغلات أخرى)
        return; 
      }
      
    } catch(e) {
      console.warn('player build error', name, e);
    }
  }

  // إذا وصلنا إلى هنا، فهذا يعني أنه لم يتم العثور على أي مشغل صالح
  frame.innerHTML = '❌ Плееры не найдены';
}

// دالة العرض (لم تتغير)
function showPlayer(src, name){
  const frame = document.getElementById('playerFrame');
  const iframe = document.createElement('iframe');
  iframe.src = src; 
  iframe.loading = 'lazy';
  iframe.title = name; 
  iframe.allowFullscreen = true; 
  iframe.setAttribute('allow', 'autoplay; fullscreen; picture-in-picture');
  
  // تنسيقات الـ iframe
  iframe.style.width = "0%";
  iframe.style.height = "0%";
  iframe.style.border = "none";
  
  frame.innerHTML = ''; 
  frame.appendChild(iframe);
}

// التشغيل التلقائي
(function(){
  const params = new URLSearchParams(location.search);
  const id = params.get('id');
  if(id) buildPlayers(id);
})();
</script>
  <script>
async function getJsonData() {
    const url = 'https://harald-as.newplayjj.com/bnsi/movies/1104882';
    
    // إعداد البيانات التي سيتم إرسالها (Body)
    const data = new URLSearchParams();
    data.append('token', 'e7b61f129f4a392ac4bf6726a9dd6a');
    data.append('av1', 'true');
    data.append('autoplay', '0');
    data.append('audio', '');
    data.append('subtitle', '');

    try {
        const response = await fetch(url, {
            method: 'POST', // نوع الطلب كما في curl
            headers: {
                'accept': '*/*',
                'content-type': 'application/x-www-form-urlencoded; charset=UTF-8',
                // الهيدر الخطير: هذا الكود سيتغير مع كل جلسة ولن يعمل إذا كان قديماً
                'borth': '5f08b7396b8a6bf8d893ec1a0a1a0dc1d19b7e6f20542b999e8689e3fa6776f4|SWRKenV2MGdvejR8MTc2NzMxNzc1OHxUampaSXZHbGliMnVFN25rdDdOYnpsXzdsbU41R0VrUkVONmtxRlp0UFZR',
                'origin': 'https://harald-as.newplayjj.com',
                'referer': 'https://harald-as.newplayjj.com/?kp=687&token=e7b61f129f4a392ac4bf6726a9dd6a',
                'x-requested-with': 'XMLHttpRequest'
            },
            body: data
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const jsonData = await response.json();
        
        // عرض النتيجة في الصفحة
        document.getElementById('result').textContent = JSON.stringify(jsonData, null, 2);
        console.log(jsonData); // عرض النتيجة في الكونسول أيضاً

    } catch (error) {
        document.getElementById('result').textContent = 'فشل الطلب: ' + error.message + '\n\nالسبب غالباً: سياسة CORS أو انتهاء صلاحية التوكن.';
        console.error('Fetch error:', error);
    }
}

// تنفيذ الدالة
getJsonData();
</script>
</body>
</html>
